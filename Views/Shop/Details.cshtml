@model TSach
@{
    string? selectedCategoryId = ViewBag.SelectedCategoryId as string;
    var crumbs = ViewBag.Breadcrumbs as List<(string Text, string Href)>;
}

@{
    ViewData["Title"] = "Details";
    Layout = "~/Views/Shared/MyLayout.cshtml";
}

@section Styles {
    <link rel="stylesheet" href="~/css/style.css" />
    <link rel="stylesheet" href="~/css/shop-style.css" />
}

<main>
    <!-- Spinner Start -->
    <div id="spinner"
         class="show bg-white position-fixed translate-middle w-100 vh-100 top-50 start-50 d-flex align-items-center justify-content-center">
        <div class="spinner-border text-primary" style="width: 3rem; height: 3rem;" role="status">
            <span class="sr-only">Loading...</span>
        </div>
    </div>
    <!-- Spinner End -->
    <!-- Single Page Header start -->
    @if (crumbs != null && crumbs.Any())
    {
        <nav aria-label="breadcrumb" style="padding-left: 100px;">
            <ol class="breadcrumb justify-content-left">
                @foreach (var c in crumbs)
                {
                    if (!string.IsNullOrEmpty(c.Href))
                    {
                        <li class="breadcrumb-item"><a href="@c.Href">@c.Text</a></li>
                    }
                    else
                    {
                        <li class="breadcrumb-item active" aria-current="page">@c.Text</li>
                    }
                }
            </ol>
        </nav>
    }
    <!-- Single Page Header End -->
    <!-- Single Products Start -->
    <div class="container-fluid shop">
        <div class="container">
            <div class="row g-4">
                <div class="col-lg-5 col-xl-3 wow fadeInUp" data-wow-delay="0.1s">
                    <div class="product-categories mb-4">
                        <h4>Thể loại</h4>
                        <ul class="list-unstyled">
                            <!--all categories-->
                            @{
                                var isAllActive = string.IsNullOrEmpty(selectedCategoryId);
                            }
                            <li>
                                <div class="categories-item">
                                    <a asp-controller="Shop" asp-action="Index"
                                       asp-route-categoryId=""
                                       asp-route-page="1"
                                       class="text-dark @(isAllActive ? "active" : "")">
                                        <i class="fas fa-apple-alt text-secondary me-2"></i>
                                        Tất cả
                                    </a>
                                </div>
                            </li>
                            <!--each category-->
                            @foreach (var tl in (List<TTheLoai>)ViewBag.Categories)
                            {
                                var maTheLoai = tl.MaTheLoai;
                                var isActive = !string.IsNullOrEmpty(selectedCategoryId) &&
                                string.Equals(selectedCategoryId, maTheLoai, StringComparison.OrdinalIgnoreCase);
                                <li>
                                    <div class="categories-item">
                                        <a asp-controller="Shop" asp-action="Index"
                                           asp-route-categoryId="@maTheLoai"
                                           asp-route-page="1"
                                           class="text-dark @(isActive ? "active" : "")">
                                            <i class="fas fa-apple-alt text-secondary me-2"></i>
                                            @tl.TenTheLoai
                                        </a>
                                    </div>
                                </li>
                            }
                        </ul>
                    </div>
                </div>
                <div class="col-lg-7 col-xl-9 wow fadeInUp" data-wow-delay="0.1s">
                    <div class="row g-4 single-product">
                        <div class="col-xl-6">
                            @{
                                var raw = @Model.Anh ?? "";
                                var safeFile = Uri.EscapeDataString(raw) + ".jpg";
                                var imgSrc = Url.Content("~/images/books/" + safeFile);
                            }
                            <img src="@imgSrc" style="width:310px; height:500px;object-fit: cover;" alt="@Model.TenSach"
                                 onerror="this.onerror=null;this.src='~/images/books/placeholder.png';"
                                 class="book-cover" />
                        </div>
                        <div class="col-xl-6">
                            <h4 class="fw-bold mb-3">@Model.TenSach</h4>
                            <p class="mb-3">Tác giả: @Model.TacGia</p>
                            <h5 class="fw-bold mb-3">@(Model.DonGiaBan is decimal dgb ? (dgb * 10000m).ToString("C", new System.Globalization.CultureInfo("vi-VN")) : "")</h5>
                            <div class="d-flex mb-4">
                                <i class="fa fa-star text-secondary"></i>
                                <i class="fa fa-star text-secondary"></i>
                                <i class="fa fa-star text-secondary"></i>
                                <i class="fa fa-star text-secondary"></i>
                                <i class="fa fa-star"></i>
                            </div>
                            
                            <div class="d-flex flex-column mb-3">
                                <small>Còn: <strong class="text-primary">@Model.SoLuong cuốn</strong></small>
                            </div>
                            <p class="mb-4">
                                Mô tả về sách...
                            </p>
                            @* <div class="input-group quantity mb-5" style="width: 100px;">
                                <div class="input-group-btn d-flex align-items-center" style="flex-direction: row;">
                                    <button class="btn btn-sm btn-minus rounded-circle bg-light border">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                                            <line x1="5" y1="12" x2="19" y2="12"></line>
                                        </svg>
                                    </button>
                                </div>
                                <input type="text" class="form-control form-control-sm text-center border-0" value="1">
                                <div class="input-group-btn d-flex align-items-center">
                                    <button class="btn btn-sm btn-plus rounded-circle bg-light border">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                                            <line x1="12" y1="5" x2="12" y2="19"></line>
                                            <line x1="5" y1="12" x2="19" y2="12"></line>
                                        </svg>
                                    </button>
                                </div>
                            </div> *@
                            <form asp-controller="Cart" asp-action="Add" method="post">
                                <button id="btn-add-cart" type="submit" class="btn btn-primary border border-secondary rounded-pill px-4 py-2 mb-4 text-primary">
                                    Thêm vào giỏ
                                </button>
                                <input type="hidden" name="maSach" value="@Model.MaSach" />
                                <input type="hidden" name="soLuong" value="1" min="1" />
                            </form>
                        </div>
                        <div class="col-lg-12">
                            <nav>
                                <div class="nav nav-tabs mb-3">
                                    <button class="nav-link active border-white border-bottom-0" type="button"
                                            role="tab" id="nav-about-tab" data-bs-toggle="tab" data-bs-target="#nav-about"
                                            aria-controls="nav-about" aria-selected="true">
                                        Mô tả sản phẩm
                                    </button>
                                </div>
                            </nav>
                            <div class="tab-content mb-5">
                                <div class="tab-pane active" id="nav-about" role="tabpanel"
                                     aria-labelledby="nav-about-tab">
                                    <h4>Thông tin chi tiết</h4>
                                    <b class="fw-bold">Nhà xuất bản:</b>
                                    <p class="small">
                                        @Model.MaNxbNavigation?.TenNxb
                                    </p>
                                    <b class="fw-bold">Thể loại:</b>
                                    <p class="small">
                                        @Model.MaTheLoaiNavigation?.TenTheLoai
                                    </p>
                                    <b class="fw-bold">Số trang:</b>
                                    <p class="small">
                                        @Model.SoTrang
                                    </p>
                                </div>
                            </div>
                        </div>
                        
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Single Products End -->
    <!-- Related Product Start -->
    <div class="container-fluid related-product">
        <div class="container">
            <div class="mx-auto text-center pb-5" style="max-width: 700px;">
                <h4 class="text-primary mb-4 border-bottom border-primary border-2 d-inline-block p-2 title-border-radius wow fadeInUp"
                    data-wow-delay="0.1s">
                    Sản phẩm tương tự
                </h4>
            </div>
            <div class="related-carousel owl-carousel pt-4">
                @foreach (var item in (IEnumerable<TSach>)ViewBag.RelatedBooks)
                {
                    <div class="related-item rounded">
                        <div class="related-item-inner border rounded">
                            <div class="related-item-inner-item">
                                @{
                                    var rawImg = @item.Anh ?? "";
                                    var safeImgFile = Uri.EscapeDataString(rawImg) + ".jpg";
                                    var imgSource = Url.Content("~/images/books/" + safeImgFile);
                                }
                                <img src="@imgSource" style="display:block;margin:0 auto;width:200px;height:300px;" alt="item.TenSach"
                                     onerror="this.onerror=null;this.src='~/images/books/placeholder.png';"
                                     class="book-cover" />
                            </div>
                            <div class="text-center rounded-bottom p-4">
                                <a asp-controller="Shop" asp-action="Details" asp-route-id="@item.MaSach" class="product-link d-block h4">@item.TenSach</a>
                                <span class="text-primary fs-5">@(item.DonGiaBan is decimal idgb ? (idgb * 10000m).ToString("C", new System.Globalization.CultureInfo("vi-VN")) : "")</span>
                            </div>
                         </div>
                        <!--Add to cart button-->
                            <div class="related-item-add border border-top-0 rounded-bottom  text-center p-4 pt-0">
                                <form asp-controller="Cart" asp-action="Add" method="post">
                                    <button id="btn-add-cart" type="submit" class="btn btn-primary border border-secondary rounded-pill px-4 py-2 mb-4 text-primary">
                                        Thêm vào giỏ
                                    </button>
                                    <input type="hidden" name="maSach" value="@item.MaSach" />
                                    <input type="hidden" name="soLuong" value="1" min="1" />
                                </form>
                            </div>
                    </div>
                }
                @* <div class="related-item rounded">
                    <div class="related-item-inner border rounded">
                        <div class="related-item-inner-item">
                            <img src="~/images/shop/product-3.png" class="img-fluid w-100 rounded-top" alt="">
                        </div>
                        <div class="text-center rounded-bottom p-4">
                            <a href="#" class="d-block h4">Apple iPad Mini <br> G2356</a>
                            <span class="text-primary fs-5">$1,050.00</span>
                        </div>
                    </div>
                    <div class="related-item-add border border-top-0 rounded-bottom  text-center p-4 pt-0">
                        <a href="#" class="btn btn-primary border-secondary rounded-pill py-2 px-4 mb-4">
                            <i class="fas fa-shopping-cart me-2"></i> Add To Cart
                        </a>
                    </div>
                </div> *@
            </div>
        </div>
    </div>
    <!-- Related Product End -->
</main>

@section Scripts {
    <!-- JavaScript Libraries -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
    <script src="~/lib/wow/wow.min.js"></script>
    <script src="~/lib/owlcarousel/owl.carousel.min.js"></script>

    <script src="~/js/script.js"></script>
    <script src="~/js/shop-script.js"></script>
}